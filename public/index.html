<!DOCTYPE html>
<html lang="id">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Expense Manager</title>
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined:opsz,wght,FILL,GRAD@24,400,0,0" />
  <link rel="stylesheet" href="style.css" />
</head>
<body>

<!-- HEADER -->
<header>
  <div class="header-controls">
    <select id="header-period" aria-label="Pilih periode">
      <option value="daily">Harian</option>
      <option value="weekly">Mingguan</option>
      <option value="monthly">Bulanan</option>
    </select>
    <div class="period-nav">
      <button id="header-prev" aria-label="Sebelumnya"><span class="material-symbols-outlined">chevron_left</span></button>
      <div id="header-period-value"></div>
      <button id="header-next" aria-label="Berikutnya"><span class="material-symbols-outlined">chevron_right</span></button>
    </div>
  </div>
  <div class="summary">
    <div>
      <small><span class="material-symbols-outlined" style="font-size:16px;vertical-align:middle">arrow_upward</span> Income</small>
      <span id="income">0</span>
    </div>
    <div>
      <small><span class="material-symbols-outlined" style="font-size:16px;vertical-align:middle">arrow_downward</span> Expense</small>
      <span id="expense">0</span>
    </div>
    <div>
      <small><span class="material-symbols-outlined" style="font-size:16px;vertical-align:middle">account_balance</span> Balance</small>
      <span id="balance">0</span>
    </div>
  </div>
</header>

<!-- CONTENT -->
<main id="content">
  <!-- TRANSAKSI -->
  <section id="page-transaksi" class="page active">
    <h3>Transaksi</h3>
    <div id="list"></div>
  </section>

  <!-- ADD TRANSACTION -->
  <section id="page-add-tx" class="page" style="display:none">
    <h3 id="add-tx-title">Add Transaction</h3>
    <form id="form-add-tx">
      <input type="date" id="tx-date" required>
      <select id="tx-wallet" required>
        <option value="">Pilih Wallet</option>
      </select>
      <input type="number" id="tx-amount" placeholder="Jumlah Transaksi" required>
      <select id="tx-title" required>
        <option value="">Pilih Judul</option>
        <option value="add-new">+ Add New</option>
      </select>
      <select id="tx-category" required>
        <option value="">Pilih Kategori</option>
        <option value="Makan">Makan</option>
        <option value="Transport">Transport</option>
        <option value="Belanja">Belanja</option>
        <option value="Pendidikan">Pendidikan</option>
        <option value="Hiburan">Hiburan</option>
        <option value="add-new-cat">+ Add New</option>
      </select>
      <textarea id="tx-description" placeholder="Deskripsi (Opsional)"></textarea>
      <button type="submit">Add</button>
      <button type="button" id="btn-delete-tx" class="btn-danger" style="display:none">Hapus</button>
      <button type="button" onclick="closeModal()">Back</button>
    </form>
  </section>

  <!-- WALLET -->
<section id="page-wallet" class="page">
  <h3>Wallet</h3>

  <div id="wallet-list"></div>
</section>


  <!-- SETTING -->
  <section id="page-setting" class="page">
    <h3>Setting</h3>
    <div class="setting-item">
      <h2>Manage Categories</h2>
      <button onclick="switchTab('manage-categories')">Edit</button>
    </div>
    <div class="setting-item">
      <h2>Manage Titles</h2>
      <button onclick="switchTab('manage-titles')">Edit</button>
    </div>
    <div class="setting-item">
      <h2>Export Data</h2>
      <button>Coming Soon</button>
    </div>
    <div class="setting-item">
      <h2>Reset Database</h2>
      <button>Coming Soon</button>
    </div>
    <div class="setting-item">
      <h2>About App</h2>
      <button>View</button>
    </div>
    <div class="setting-item">
      <div>
        <h2>Kode Registrasi</h2>
        <small>Kode berganti tiap 5 menit</small>
      </div>
      <div>
        <strong id="reg-code">••••••</strong>
        <small id="reg-exp" style="display:block;color:#777"></small>
        <button class="btn" style="margin-top:8px" onclick="refreshRegCode()">Tampilkan/Refresh</button>
      </div>
    </div>
    <div class="setting-item">
      <h2>Logout</h2>
      <button onclick="logout()">Keluar</button>
    </div>
  </section>

  <!-- MANAGE CATEGORIES -->
  <section id="page-manage-categories" class="page">
    <h3>Manage Categories</h3>
    <div class="dual-grid">
      <div class="dual-panel">
        <h4>Pengeluaran</h4>
        <button class="add-top" onclick="addCategoryDual('expense')">Tambah Pengeluaran</button>
        <div id="manage-categories-expense" class="scroll-list"></div>
      </div>
      <div class="dual-panel">
        <h4>Pemasukan</h4>
        <button class="add-top" onclick="addCategoryDual('income')">Tambah Pemasukan</button>
        <div id="manage-categories-income" class="scroll-list"></div>
      </div>
    </div>
    <button style="margin-top:12px" onclick="switchTab('setting')">Back</button>
  </section>

  <!-- MANAGE TITLES -->
  <section id="page-manage-titles" class="page">
    <h3>Manage Titles</h3>
    <div class="dual-grid">
      <div class="dual-panel">
        <h4>Pengeluaran</h4>
        <div id="manage-titles-expense"></div>
        <button onclick="addTitleDual('expense')">Tambah Pengeluaran</button>
      </div>
      <div class="dual-panel">
        <h4>Pemasukan</h4>
        <div id="manage-titles-income"></div>
        <button onclick="addTitleDual('income')">Tambah Pemasukan</button>
      </div>
    </div>
    <button style="margin-top:12px" onclick="switchTab('setting')">Back</button>
  </section>
</main>

<!-- FLOATING ADD BUTTON -->
<button class="fab" id="fab" onclick="handleFabClick()"><span class="material-symbols-outlined">add</span></button>

<!-- TX OPTIONS MINI -->
<div id="tx-options-mini" class="tx-options-mini">
  <button class="mini-btn" onclick="selectTxType('income')"><span class="material-symbols-outlined">savings</span></button>
  <button class="mini-btn" onclick="selectTxType('expense')"><span class="material-symbols-outlined">money_off</span></button>
  <button class="mini-btn" onclick="selectTxType('transfer')"><span class="material-symbols-outlined">sync_alt</span></button>
</div>

  <!-- REPORT -->
  <section id="page-report" class="page">
    <h3>Report</h3>
    <div class="report-controls">
      <label>Basis: 
        <select id="report-basis">
          <option value="category">Kategori</option>
          <option value="title">Judul</option>
          <option value="wallet">Wallet</option>
        </select>
      </label>
      <label>Tipe:
        <select id="report-type">
          <option value="pie">Diagram Lingkaran</option>
          <option value="bar">Diagram Batang</option>
        </select>
      </label>
      <label>Detail dari:
        <select id="report-filter-type" onchange="renderReportFilter()">
          <option value="">— Tidak ada —</option>
          <option value="title">Judul</option>
          <option value="category">Kategori</option>
        </select>
      </label>
      <select id="report-filter-value" style="min-width:140px" onchange="updateReport()" disabled>
        <option value="">Pilih…</option>
      </select>
      <div id="period-selector"></div>
      <button id="apply-report" onclick="updateReport()">Terapkan</button>
    </div>
    <div class="report-tabs">
      <button class="report-tab active" onclick="switchReport('daily', this)">Harian</button>
      <button class="report-tab" onclick="switchReport('monthly', this)">Bulanan</button>
      <button class="report-tab" onclick="switchReport('yearly', this)">Tahunan</button>
    </div>
    <div class="report-content">
      <div id="report-chart-wrap"><canvas id="report-chart"></canvas></div>
      <div id="report-summary"></div>
    </div>
  </section>

<nav class="bottom-nav">
  <button class="nav-item active" onclick="switchTab('transaksi', this)">
    <span class="material-symbols-outlined">receipt_long</span>
    <span class="label">Transaksi</span>
  </button>
  <button class="nav-item" onclick="switchTab('wallet', this)">
    <span class="material-symbols-outlined">account_balance_wallet</span>
    <span class="label">Wallet</span>
  </button>
  <button class="nav-item" onclick="switchTab('report', this)">
    <span class="material-symbols-outlined">insights</span>
    <span class="label">Report</span>
  </button>
  <button class="nav-item" onclick="switchTab('setting', this)">
    <span class="material-symbols-outlined">settings</span>
    <span class="label">Setting</span>
  </button>
</nav>

<script src="app.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<!-- GENERIC MODAL -->
<div id="app-modal" class="modal">
  <div class="modal-content">
    <button class="modal-close" id="modal-close" aria-label="Close"><span class="material-symbols-outlined">close</span></button>
    <div id="modal-container"></div>
  </div>
  
</div>

<!-- WALLET ADD MODAL CONTENT (hidden template) -->
<section id="modal-add-wallet" style="display:none">
  <h3>Add Wallet</h3>
  <form id="form-add-wallet">
    <input type="text" id="wallet-name" placeholder="Nama wallet" required>
    <input type="number" id="wallet-balance" placeholder="Saldo awal" value="0" required>
    <button type="submit">Simpan</button>
    <button type="button" onclick="closeModal()">Batal</button>
  </form>
</section>

<!-- REPORT DETAIL MODAL CONTENT (hidden template) -->
<section id="modal-report-detail" style="display:none">
  <h3 id="report-detail-title">Detail</h3>
  <div id="report-detail-list"></div>
</section>

<!-- LOADING OVERLAY -->
<div id="loading" class="loading-overlay" aria-live="polite" aria-busy="true">
  <div class="loading-box">
    <div class="spinner" aria-hidden="true"></div>
    <span id="loading-text">Loading…</span>
  </div>
  
</div>
</body>
</html>
